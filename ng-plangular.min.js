!function(){"use strict";var t=angular.module("plangular",[]);t.directive("plangular",["$http","plangularConfig",function(t,i){var n=i.clientId,a=document.createElement("audio"),e={currentTrack:!1,playing:!1,tracks:[],i:0,playlistIndex:0,data:{},currentTime:0,duration:0,load:function(t,i){this.tracks[i]=t,this.playing||this.i||0!=i||(this.currentTrack=this.tracks[0])},play:function(t,i){this.i=t||0;var e=this.tracks[this.i];if(e.tracks){this.playlistIndex=i||0,this.playing=e.tracks[this.playlistIndex];var s=e.tracks[this.playlistIndex].stream_url+"?client_id="+n}else{this.playing=e;var s=e.stream_url+"?client_id="+n}this.currentTrack=this.playing,s!=a.src&&(a.src=s),a.play()},pause:function(){a.pause(),this.playing=!1},playPause:function(t,i){var n=this.tracks[t];n.tracks&&this.playing!=n.tracks[i]?this.play(t,i):n.tracks||this.playing==n?this.pause():this.play(t)},next:function(){var t=this.tracks[this.i].tracks||null;if(t&&this.playlistIndex<t.length-1)this.playlistIndex++,this.play(this.i,this.playlistIndex);else if(this.i<this.tracks.length-1)if(this.i++,this.tracks[this.i].tracks){var t=this.tracks[this.i].tracks||null;this.playlistIndex=0,this.play(this.i,this.playlistIndex)}else this.play(this.i);else this.i>=this.tracks.length-1&&this.pause()},previous:function(){var t=this.tracks[this.i].tracks||null;t&&this.playlistIndex>0?(this.playlistIndex--,this.play(this.i,this.playlistIndex)):this.i>0&&(this.i--,this.tracks[this.i].tracks?(this.playlistIndex=this.tracks[this.i].tracks.length-1,this.play(this.i,this.playlistIndex)):this.play(this.i))},seek:function(t){if(!a.readyState)return!1;var i=t.offsetX/t.target.offsetWidth;a.currentTime=i*a.duration}};a.addEventListener("timeupdate",function(){e.currentTime=a.currentTime,e.duration=a.duration},!1),a.addEventListener("ended",function(){e.tracks.length>0?e.next():e.pause()},!1);var s=0;return{restrict:"A",scope:!0,link:function(i,r,l){function c(t){for(var n in t)i[n]=t[n]}var u=l.plangular,o={url:u,client_id:n,callback:"JSON_CALLBACK"};if(i.player=e,i.audio=a,i.currentTime=0,i.duration=0,u&&(i.index=s,s++),u)if(e.data[u])i.track=e.data[u],c(i.track);else if(u.indexOf("blend.io")>-1){var h=u.replace(/http[s]+\:\/\/blend\.io\/project\//,"");o.url="https://blend.io/api/project/"+h+".json",t.jsonp(o.url,{params:o}).success(function(t){t={kind:"track",id:t._id,title:t.name,duration:"n/a",state:t.state,description:t.desc,bpm:t.bpm,uri:t.short_url,user:{id:t.user.id,kind:"user",username:t.user.name},permalink_url:t.short_url,waveform_url:null,artwork_url:"https://s3.amazonaws.com/s3.blend.io/user/img/"+t.user.id+".jpg",stream_url:t.preview.url,playback_count:t.plays,download_count:null,favoritings_count:t.likes.length,comment_count:null},console.log(t),i.track=t,c(i.track),e.data[u]=t,e.load(t,i.index)})}else t.jsonp("//api.soundcloud.com/resolve.json",{params:o}).success(function(t){i.track=t,c(i.track),e.data[u]=t,e.load(t,i.index)});else;i.play=function(t){e.play(i.index,t)},i.pause=function(){e.pause()},i.playPause=function(t){e.playPause(i.index,t)},i.next=function(){e.next()},i.previous=function(){e.previous()},a.addEventListener("timeupdate",function(){i.track==e.tracks[e.i]&&i.$apply(function(){i.currentTime=e.currentTime,i.duration=e.duration})},!1),i.seek=function(t){e.tracks[e.i]==i.track&&e.seek(t)}}}}]),t.directive("plangularIcon",function(){var t={play:"M0 0 L32 16 L0 32 z",pause:"M0 0 H12 V32 H0 z M20 0 H32 V32 H20 z",previous:"M0 0 H4 V14 L32 0 V32 L4 18 V32 H0 z",next:"M0 0 L28 14 V0 H32 V32 H28 V18 L0 32 z",close:"M4 8 L8 4 L16 12 L24 4 L28 8 L20 16 L28 24 L24 28 L16 20 L8 28 L4 24 L12 16 z",chevronRight:"M12 1 L26 16 L12 31 L8 27 L18 16 L8 5 z",chevronLeft:"M20 1 L24 5 L14 16 L24 27 L20 31 L6 16 z",heart:"M0 10 C0 6, 3 2, 8 2 C12 2, 15 5, 16 6 C17 5, 20 2, 24 2 C30 2, 32 6, 32 10 C32 18, 18 29, 16 30 C14 29, 0 18, 0 10"};return{restrict:"A",scope:!0,link:function(i,n,a){var e=n[0],s=a.plangularIcon,r=document.createElementNS("http://www.w3.org/2000/svg","path");if(!t[s]){var l="";for(var c in t)l+=c+", ";return console.error("No icon found for "+s+".\n\nIcons available:\n"+l+"\n\nMore icons available from http://jxnblk.github.io/geomicons-open"),!1}e.classList.add("plangular-icon","plangular-icon-"+s),e.setAttribute("viewBox","0 0 32 32"),e.setAttribute("style","max-height:100%"),e.setAttribute("fill","currentColor"),r.setAttribute("d",t[s]),e.appendChild(r)}}}),t.filter("prettyTime",function(){return function(t){var i=Math.floor(t/3600),n="0"+Math.floor(t%3600/60),a="0"+Math.floor(t%60);return n=n.substr(n.length-2),a=a.substr(a.length-2),isNaN(a)?"00:00":i?i+":"+n+":"+a:n+":"+a}}),t.provider("plangularConfig",function(){this.clientId="0d33361983f16d2527b01fbf6408b7d7";var t=this;this.$get=function(){return{clientId:t.clientId}}})}();